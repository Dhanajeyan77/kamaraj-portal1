{% extends "layout.html" %}

{% block content %}
<style>
    /* ==========================================
       1. GLOBAL THEME & GRID
       ========================================== */
    :root {
        --lc-green: #2db55d;
        --lc-orange: #ffa116;
        --lc-border: #e2e8f0;
        --editor-bg: #0d1117;
    }

    /* Fixed Layout: Prevents footer overlay */
    .coding-environment {
        padding: 20px;
        background-color: #f0f2f5;
        height: calc(100vh - 80px); 
        display: flex;
        flex-direction: column;
        overflow: hidden; 
        font-family: 'Inter', -apple-system, sans-serif;
    }

    .split-container {
        display: flex;
        gap: 16px; 
        flex: 1;
        max-width: 1850px;
        margin: 0 auto;
        width: 100%;
        overflow: hidden; /* Independent scrolling */
    }

    /* ==========================================
       2. LEFT PANE: FIXED PROBLEM DESCRIPTION
       ========================================== */
    .description-side {
        flex: 1;
        background: #ffffff;
        padding: 35px;
        border-radius: 12px;
        border: 1px solid var(--lc-border);
        overflow-y: auto; /* Independent scroll */
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        display: flex;
        flex-direction: column;
    }

    .description-side h2 {
        font-size: 1.85rem;
        font-weight: 800;
        color: #1a1a1a;
        margin-bottom: 12px;
    }

    .difficulty-tag {
        display: inline-flex;
        background: #fff7ed;
        color: var(--lc-orange); 
        padding: 5px 14px;
        border-radius: 4px;
        font-size: 0.8rem;
        font-weight: 700;
        text-transform: uppercase;
        margin-bottom: 25px;
        width: fit-content;
    }

    .content-body {
        line-height: 1.8;
        font-size: 1.05rem;
        color: #374151;
        white-space: pre-wrap;
    }

    /* INSTRUCTION DESIGN */
    .setup-instructions {
        margin-top: 40px;
        padding: 25px;
        background: #f0fdf4;
        border-left: 8px solid var(--lc-green);
        border-radius: 12px;
    }

    .setup-instructions h4 {
        color: #166534;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 1.15rem;
    }

    .setup-instructions li {
        margin-bottom: 10px;
        color: #14532d;
        font-size: 0.95rem;
        list-style: none;
    }

    .setup-instructions code {
        background: #d1fae5;
        color: #065f46;
        padding: 3px 8px;
        border-radius: 6px;
        font-weight: 800;
        font-family: 'Fira Code', monospace;
    }

    /* ==========================================
       3. RIGHT PANE: LARGE EDITOR & ENHANCED CONSOLE
       ========================================== */
    .editor-side {
        flex: 1.6; 
        display: flex;
        flex-direction: column;
        gap: 12px;
        height: 100%;
    }

    /* MASSIVE TYPING AREA */
    .editor-wrapper {
        flex: 2.8; /* Extended length for coding */
        display: flex;
        flex-direction: column;
        background: #1e1e1e;
        border-radius: 12px;
        overflow: hidden;
        border: 1px solid #333;
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    }

    .editor-header {
        background: #2d2d2d;
        padding: 12px 24px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    #editor {
        flex: 1;
        width: 100%;
        background: var(--editor-bg);
        color: #e6edf3;
        font-family: 'Fira Code', 'Cascadia Code', monospace;
        padding: 25px;
        border: none;
        font-size: 1.1rem;
        line-height: 1.6;
        outline: none;
        resize: none;
    }

    /* INCREASED EXECUTION BOX */
    .terminal {
        flex: 0.9; /* INCREASED SIZE from 0.7 to 0.9 */
        background: white;
        border: 2px solid var(--lc-border);
        border-radius: 12px;
        display: flex;
        flex-direction: column;
        overflow: hidden;
        margin-bottom: 40px; 
    }

    .terminal-header {
        background: #f8fafc;
        padding: 10px 24px;
        font-weight: 800;
        font-size: 0.85rem;
        color: #475569;
        border-bottom: 1px solid var(--lc-border);
    }

    .output-text {
        padding: 20px;
        font-family: 'Fira Code', monospace;
        font-size: 1rem;
        white-space: pre-wrap; /* Fixes congestion */
        overflow-y: auto;
    }

    /* CSS Linter Fix: Classes for status colors */
    .status-success { color: #16a34a; font-weight: 800; }
    .status-failed { color: #dc2626; font-weight: 800; }

    .run-btn {
        background: var(--lc-green);
        color: white;
        padding: 10px 30px;
        border-radius: 8px;
        font-weight: 800;
        border: none;
        cursor: pointer;
    }

    /* FOOTER GUARD */
    .footer-guard {
        height: 60px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #f0f2f5;
        font-size: 0.8rem;
        color: #94a3b8;
    }
</style>

<div class="coding-environment">
    <div class="split-container">
        
        <div class="description-side">
            <div class="difficulty-tag">Challenge 2026</div>
            <h2>{{ question.title }}</h2>
            <hr style="border: 0; border-top: 1px solid #f1f5f9; margin-bottom: 25px;">
            <div class="content-body">{{ question.content }}</div>

            <div class="setup-instructions">
                <h4>üöÄ Setup Instructions:</h4>
                <div id="java-instructions" style="display:none;">
                    <li>‚Ä¢ <strong>Main Class:</strong> <code>public class Solution</code></li>
                    <li>‚Ä¢ <strong>Input:</strong> Accessed via <code>args[0]</code></li>
                </div>
                <div id="python-instructions">
                    <li>‚Ä¢ <strong>Variables:</strong> Use <code>input_val</code> and <code>output_val</code></li>
                </div>
            </div>
        </div>

        <div class="editor-side">
            <form method="POST" id="submission-form" class="editor-wrapper">
                <div class="editor-header">
                    <select name="lang_choice" id="lang_choice" style="background:#444; color:#fff; border:none; padding:6px 12px; border-radius:6px; font-weight:700;">
                        <option value="python">Python 3.11</option>
                        <option value="java">Java 21</option>
                    </select>
                    <button type="submit" class="run-btn">Run & Submit</button>
                </div>
                
                <div id="java-alert" style="display:none; background:#fff9db; color:#856404; padding:8px 25px; font-size:0.8rem; border-bottom:1px solid #ffeeba;">
                    ‚ö†Ô∏è <strong>Java Rule:</strong> Class name must be <strong>Solution</strong>.
                </div>

                <textarea name="user_code" id="editor" spellcheck="false">{{ user_code if user_code else "" }}</textarea>
            </form>

            <div class="terminal">
                <div class="terminal-header">
                    <span style="color:var(--lc-green)">‚óè</span> Execution Console Result
                </div>
                <div class="output-text">
                    {% if output %}
                        <div class="{% if 'FAILED' in output %}status-failed{% else %}status-success{% endif %}">
                            {% if 'FAILED' in output %}‚ùå FAILED{% else %}‚úÖ SUCCESS{% endif %}
                        </div>
                        <div style="margin-top: 8px;">{{ output }}</div>
                    {% else %}
                        <span style="color: #94a3b8; font-style: italic;">Awaiting student code results...</span>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    <div class="footer-guard">
        ¬© 2026 Kamaraj College - Computer Science Department
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const editor = document.getElementById('editor');
        const langSelect = document.getElementById('lang_choice');
        const javaIns = document.getElementById('java-instructions');
        const pyIns = document.getElementById('python-instructions');
        const alertBox = document.getElementById('java-alert');

        /**
         * 1. FIXED BOILERPLATE LOGIC
         * Properly switches templates and ensures Java boilerplate appears
         */
        langSelect.addEventListener('change', function() {
            if (this.value === 'java') {
                javaIns.style.display = 'block';
                pyIns.style.display = 'none';
                alertBox.style.display = 'block';
                
                // Switch to Java Template
                editor.value = "public class Solution {\n    public static void main(String[] args) {\n        String input_val = args[0];\n        // Write logic below\n    }\n}";
            } else {
                javaIns.style.display = 'none';
                pyIns.style.display = 'block';
                alertBox.style.display = 'none';
                
                // Clear and reset Python Template
                editor.value = "# Start implementing Python solution\n\ninput_val = ...\noutput_val = ...";
            }
        });

        /**
         * 2. Advanced Indentation Support
         */
        editor.addEventListener('keydown', function(e) {
            if (e.key === 'Tab') {
                e.preventDefault();
                const start = this.selectionStart;
                this.value = this.value.substring(0, start) + "    " + this.value.substring(this.selectionEnd);
                this.selectionStart = this.selectionEnd = start + 4;
            }
            if (e.key === 'Enter') {
                e.preventDefault();
                const start = this.selectionStart;
                const textBefore = this.value.substring(0, start);
                const currentLine = textBefore.split('\n').pop();
                const whitespace = currentLine.match(/^(\s*)/)[0];
                let extra = (currentLine.trim().endsWith(':') || currentLine.trim().endsWith('{')) ? "    " : "";
                const insert = "\n" + whitespace + extra;
                this.value = this.value.substring(0, start) + insert + this.value.substring(start);
                this.selectionStart = this.selectionEnd = start + insert.length;
            }
        });

        /**
         * 3. Anti-Cheating Suite
         */
        editor.addEventListener('paste', e => { 
            e.preventDefault(); 
            alert("‚ö†Ô∏è Academic Integrity: Manual typing is required for credit."); 
        });
        editor.addEventListener('contextmenu', e => e.preventDefault());
        
        // Auto-scroll terminal
        const term = document.querySelector('.output-text');
        if (term) term.scrollTop = term.scrollHeight;
    });
</script>
{% endblock %}