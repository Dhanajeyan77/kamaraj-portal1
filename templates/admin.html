{% extends "layout.html" %}
{% block content %}
<div class="admin-container">
    <div class="admin-header">
        <div class="header-main">
            <h2>Class Progress Report</h2>
            <p>Viewing Task for: <strong>{{ q_info.date if q_info else "Day " ~ qid }}</strong></p>
        </div>
        
        <div class="admin-nav">
            <div class="calendar-tool" style="margin-right: 20px;">
                <label style="font-size: 0.8rem; font-weight: bold;">Jump to Date:</label>
                <input type="date" id="cal-jump" value="{{ q_info.date }}" onchange="jumpDate()">
            </div>
            <a href="/admin/{{ qid - 1 if qid > 1 else 1 }}" class="nav-btn">‚¨ÖÔ∏è Previous</a>
            <a href="/admin/{{ qid + 1 if qid < 90 else 90 }}" class="nav-btn">Next ‚û°Ô∏è</a>
        </div>
    </div>

    <div class="stats-cards">
        <div class="card">
            <h3>Total Users</h3>
            <p>{{ report|length }}</p>
        </div>
        <div class="card success-card">
            <h3>Completed Today</h3>
            <p>{{ report|selectattr('status', 'equalto', 'Completed')|list|length }} / {{ report|length }}</p>
        </div>
    </div>

    <table class="report-table">
        <thead>
            <tr>
                <th>Roll No</th>
                <th>Name</th>
                <th>Status</th>
                <th>Submission Time (IST)</th>
                <th>Analytics</th>
            </tr>
        </thead>
        <tbody>
            {% for row in report %}
            <tr class="{{ 'completed-row' if row.status == 'Completed' else 'pending-row' }}">
                <td>{{ row.roll_no }}</td>
                <td>{{ row.name }}</td>
                <td>
                    <span class="status-badge {{ 'success' if row.status == 'Completed' else 'pending' }}">
                        {{ '‚úÖ Completed' if row.status == 'Completed' else '‚è≥ Pending' }}
                    </span>
                </td>
                <td>{{ row.timestamp.strftime('%I:%M %p') if row.timestamp else '---' }}</td>
                <td>
                    <a href="{{ url_for('admin_track', user=row.roll_no) }}" class="deep-dive-btn">
                        üìä Deep Dive
                    </a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script>
function jumpDate() {
    const d = document.getElementById('cal-jump').value;
    if(d) window.location.href = `/admin?date=${d}`;
}
</script>

<style>
    /* ... (Keep your existing styles, adding this one) ... */
    .calendar-tool input { padding: 5px; border-radius: 5px; border: 1px solid #ccc; cursor: pointer; }
    .admin-container { padding: 40px; max-width: 1100px; margin: auto; font-family: sans-serif; }
    .admin-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 3px solid #007bff; padding-bottom: 15px; }
    .report-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    .report-table th { background: #343a40; color: white; padding: 15px; text-align: left; }
    .report-table td { padding: 15px; border-bottom: 1px solid #eee; }
    .success { background: #d4edda; color: #155724; padding: 5px 10px; border-radius: 15px; }
    .pending { background: #fff3cd; color: #856404; padding: 5px 10px; border-radius: 15px; }
    .deep-dive-btn { background: #007bff; color: white; padding: 8px 12px; border-radius: 5px; text-decoration: none; font-size: 0.8rem; }
</style>
{% endblock %}